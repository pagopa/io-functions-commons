ApplicationInfo:
  type: object
  properties:
    name: 
      type: string
    version: 
      type: string
  required:
    - name
    - version
ProblemJson:
  type: object
  properties:
    type:
      type: string
      format: uri
      description: |-
        An absolute URI that identifies the problem type. When dereferenced,
        it SHOULD provide human-readable documentation for the problem type
        (e.g., using HTML).
      default: about:blank
      example: https://example.com/problem/constraint-violation
    title:
      type: string
      description: |-
        A short, summary of the problem type. Written in english and readable
        for engineers (usually not suited for non technical stakeholders and
        not localized); example: Service Unavailable
    status:
      $ref: "#/HttpStatusCode"
    detail:
      type: string
      description: |-
        A human readable explanation specific to this occurrence of the
        problem.
      example: There was an error processing the request
    instance:
      type: string
      format: uri
      description: |-
        An absolute URI that identifies the specific occurrence of the problem.
        It may or may not yield further information if dereferenced.
NotificationChannel:
  type: string
  description: |-
    All notification channels.
  x-extensible-enum:
    - EMAIL
    - WEBHOOK
  example: EMAIL
BlockedInboxOrChannel:
  type: string
  description: |-
    All notification channels plus the message inbox.
    These represent all the possible channels a user could block.
  x-extensible-enum:
    - EMAIL
    - INBOX
    - WEBHOOK
  example: INBOX
NotificationChannelStatusValue:
  type: string
  description: |-
    The status of a notification (one for each channel).
    "SENT": the notification was succesfully sent to the channel (ie. email or push notification)
    "THROTTLED": a temporary failure caused a retry during the notification processing;
      the notification associated with this channel will be delayed for a maximum of 7 days or until the message expires
    "EXPIRED": the message expired before the notification could be sent;
      this means that the maximum message time to live was reached; no notification will be sent to this channel
    "FAILED": a permanent failure caused the process to exit with an error, no notification will be sent to this channel
  x-extensible-enum:
    - SENT
    - THROTTLED
    - EXPIRED
    - FAILED
  example: SENT
NotificationChannelStatus:
  type: object
  properties:
    channel:
      $ref: "#/NotificationChannel"
    status:
      $ref: "#/NotificationChannelStatusValue"
    updated_at:
      $ref: "#/Timestamp"
    version:
      type: integer
  required:
    - channel
    - status
    - updated_at

MessageContentBase:
  type: object
  properties:
    subject:
      $ref: "#/MessageSubject"
    markdown:
      $ref: "#/MessageBodyMarkdown"
    require_secure_channels:
      type: boolean
      description: |-
        When true, messages won't trigger email notifications (only push).
  required:
    - subject
    - markdown
MessageContent:
  allOf:
    - $ref: "#/MessageContentBase"
    - type: object
      properties:
        payment_data:
          $ref: "#/PaymentData"
        prescription_data:
          $ref: "#/PrescriptionData"
        legal_data:
          $ref: '#/LegalData'
        eu_covid_cert:
          $ref: "#/EUCovidCert"
        third_party_data:
          $ref: "#/ThirdPartyData"
        due_date:
          $ref: "#/Timestamp"
NewMessageContent:
  allOf:
    - $ref: "#/MessageContentBase"
    - type: object
      properties:
        payment_data:
          $ref: "#/PaymentDataWithRequiredPayee"
        due_date:
          $ref: "#/Timestamp"
        prescription_data:
          $ref: "#/PrescriptionData"
        eu_covid_cert:
          $ref: "#/EUCovidCert"
        third_party_data:
          $ref: "#/ThirdPartyData"
        legal_data:
          $ref: '#/LegalData'
NewMessage:
  type: object
  properties:
    time_to_live:
      $ref: "#/TimeToLiveSeconds"
    content:
      $ref: "#/MessageContent"
    default_addresses:
      $ref: "#/NewMessageDefaultAddresses"
    fiscal_code:
      $ref: "#/FiscalCode"
    feature_level_type:
      $ref: "#/FeatureLevelType"
  required:
    - content
FeatureLevelType:
   type: string
   default: STANDARD
   x-extensible-enum:
     - STANDARD
     - ADVANCED
   example: STANDARD
PrescriptionData:
  type: object
  description: |-
    Metadata needed to process medical prescriptions.
  properties:
    nre:
      $ref: "#/PrescriptionNRE"
    iup:
      $ref: "#/PrescriptionIUP"
    prescriber_fiscal_code:
      $ref: "#/PrescriberFiscalCode"
  required:
    - nre
LegalData:
  type: object
  properties:
    sender_mail_from: 
      type: string
      minLength: 1
    has_attachment:
      type: boolean
      default: false
    message_unique_id:
      type: string
      minLength: 1
    original_message_url:
      type: string
      minLength: 1
    pec_server_service_id:
      $ref: "#/ServiceId"
  required:
    - sender_mail_from
    - has_attachment
    - message_unique_id
RemoteContentDetails:
  type: object
  properties:
    markdown:
      $ref: "#/MessageBodyMarkdown"
    subject:
      $ref: "#/MessageSubject"
  required:
    - markdown
    - subject
ThirdPartyData:
  type: object
  description: |-
    Payload containing all information needed to retrieve and visualize third party message details
  properties:
    id:
      type: string
      description: Unique id for retrieving third party enriched information about the message
      minLength: 1
    original_sender:
      type: string
      description: |-
        Either a ServiceId or a simple string representing the sender name
      minLength: 1
    original_receipt_date:
      $ref: "#/Timestamp"
    has_attachments:
      type: boolean
      default: false
    has_remote_content:
      type: boolean
      default: false
    has_precondition:
      $ref: "#/HasPrecondition"
    summary:
      type: string
      minLength: 1
    configuration_id:
      $ref: "#/Ulid"
  required:
    - id
HasPrecondition:
  type: string
  x-extensible-enum:
    - ALWAYS
    - ONCE
    - NEVER
EUCovidCert:
  type: object
  description: |-
    Paylod with access token to retrieve a EU Covid Certificate
  properties:
    auth_code:
      type: string
  required:
    - auth_code
PrescriptionIUP:
  description: The field *Identificativo Unico di Prescrizione* identifies the medical prescription at regional level.
  type: string
  minLength: 1
  maxLength: 16
PrescriptionNRE:
  description: The field *Numero ricetta elettronica* identifies the medical prescription at national level.
  type: string
  minLength: 15
  maxLength: 15
Payee:
  type: object
  description: |-
    Metadata needed to explicit payment's payee.
  properties:
    fiscal_code:
      $ref: "#/OrganizationFiscalCode"
  required:
    - fiscal_code
PaymentDataBase:
  type: object
  description: |-
    Metadata needed to process pagoPA payments.
  properties:
    amount:
      $ref: "#/PaymentAmount"
    notice_number:
      $ref: "#/PaymentNoticeNumber"
    invalid_after_due_date:
      type: boolean
      default: false
  required:
    - amount
    - notice_number
PaymentData:
  allOf:
    - $ref: "#/PaymentDataBase"
    - type: object
      properties:
        payee:
          $ref: "#/Payee"
PaymentDataWithRequiredPayee:
  allOf:
    - $ref: "#/PaymentDataBase"
    - type: object
      properties:
        payee:
          $ref: "#/Payee"
      required:
        - payee
PaymentNoticeNumber:
  description: >-
    The field "Numero Avviso" of pagoPa, needed to identify the payment. 
    Format is `<aux digit(1n)>[<application code> (2n)]<codice IUV (15|17n)>`. See [pagoPa
    specs](https://docs.pagopa.it/saci/specifiche-attuative-dei-codici-identificativi-di-versamento-riversamento-e-rendicontazione/premessa)
    for more info on this field and the IUV.
  type: string
  pattern: "^[0123][0-9]{17}$"
PaymentAmount:
  description: |-
    Amount of payment in euro cent. PagoPA accepts up to 9999999999 euro cents.
  type: integer
  minimum: 1
  maximum: 9999999999
MaxAllowedPaymentAmount:
  description: |-
    Maximum amount in euro cents that a service is allowed to charge to a user.
  type: integer
  minimum: 0
  maximum: 9999999999
  default: 0
RejectedMessageStatusValue:
  type: string
  x-extensible-enum:
    - REJECTED
RejectionReason:
  type: string
  x-extensible-enum:
    - SERVICE_NOT_ALLOWED
    - USER_NOT_FOUND
    - UNKNOWN
NotRejectedMessageStatusValue:
  type: string
  x-extensible-enum:
    - ACCEPTED
    - THROTTLED
    - FAILED
    - PROCESSED
MessageStatusValue:
  x-one-of: true
  allOf:
    - $ref: "#/RejectedMessageStatusValue"
    - $ref: "#/NotRejectedMessageStatusValue"
  description: |-
    The processing status of a message.
    "ACCEPTED": the message has been accepted and will be processed for delivery;
      we'll try to store its content in the user's inbox and notify him on his preferred channels
    "THROTTLED": a temporary failure caused a retry during the message processing;
      any notification associated with this message will be delayed for a maximum of 7 days
    "FAILED": a permanent failure caused the process to exit with an error, no notification will be sent for this message
    "PROCESSED": the message was succesfully processed and is now stored in the user's inbox;
      we'll try to send a notification for each of the selected channels
    "REJECTED": either the recipient does not exist, or the sender has been blocked
MessageStatus:
  type: object
  properties:
    status:
      $ref: "#/MessageStatusValue"
    updated_at:
      $ref: "#/Timestamp"
    version:
      type: integer
  required:
    - status
    - updated_at
MessageStatusWithAttributes:
  allOf:
    - $ref: "#/MessageStatus"
    - $ref: "#/MessageStatusAttributes"
CreatedMessageWithContent:
  type: object
  properties:
    id:
      type: string
    fiscal_code:
      $ref: "#/FiscalCode"
    time_to_live:
      $ref: "#/TimeToLiveSeconds"
    created_at:
      $ref: "#/Timestamp"
    content:
      $ref: "#/NewMessageContent"
    sender_service_id:
      $ref: "#/ServiceId"
  required:
    - id
    - fiscal_code
    - created_at
    - content
    - sender_service_id
CreatedMessageWithoutContent:
  type: object
  properties:
    id:
      type: string
    fiscal_code:
      $ref: "#/FiscalCode"
    time_to_live:
      $ref: "#/TimeToLiveSeconds"
    created_at:
      $ref: "#/Timestamp"
    sender_service_id:
      $ref: "#/ServiceId"
  required:
    - id
    - fiscal_code
    - created_at
    - sender_service_id

BaseEnrichedMessage:
  type: object
  properties:
    id:
      type: string
    fiscal_code:
      $ref: "#/FiscalCode"
    time_to_live:
      $ref: "#/TimeToLiveSeconds"
    created_at:
      $ref: "#/Timestamp"
    sender_service_id:
      $ref: "#/ServiceId"
    service_name:
      type: string
    organization_name:
      type: string
    organization_fiscal_code:
      $ref: "#/OrganizationFiscalCode"
    message_title:
      type: string
    category:
      $ref: '#/MessageCategory'
    has_attachments:
      type: boolean
      default: false
    has_precondition:
      type: boolean
      default: false
  required:
    - id
    - fiscal_code
    - created_at
    - sender_service_id
    - service_name
    - organization_name
    - organization_fiscal_code
    - message_title
EnrichedMessage:
  allOf:
    - $ref: "#/BaseEnrichedMessage"
    - $ref: "#/MessageStatusAttributes"

ExternalCreatedMessageWithoutContent:
  allOf:
    - $ref: "#/CreatedMessageWithoutContent"
    - type: object
      properties:
        feature_level_type:
          $ref: "#/FeatureLevelType"
      required:
        - feature_level_type
ExternalCreatedMessageWithContent:
  allOf:
    - $ref: "#/CreatedMessageWithContent"
    - type: object
      properties:
        feature_level_type:
          $ref: "#/FeatureLevelType"
      required:
        - feature_level_type
ExternalMessageResponseWithoutContent:
  type: object
  properties:
    message:
      $ref: "#/ExternalCreatedMessageWithoutContent"
    notification:
      $ref: "#/MessageResponseNotificationStatus"
    status:
      $ref: "#/MessageStatusValue"
    read_status: 
      $ref: "#/ReadStatus"
      description: |-
        Describes whether a user has read the message or not
        NOTE  : This value is only available for ADVANCED messages
        NOTE 2: `UNAVAILABLE` will be returned if user revoked the permission to access to read status
    payment_status:
      $ref: "#/PaymentStatus"
      description: |-
        Describes the state of the related payment notice
        NOTE: This value is only available for ADVANCED payment messages
  required:
    - message
ExternalMessageResponseWithContent:
  type: object
  properties:
    message:
      $ref: "#/ExternalCreatedMessageWithContent"
    notification:
      $ref: "#/MessageResponseNotificationStatus"
    status:
      $ref: "#/MessageStatusValue"
    read_status: 
      $ref: "#/ReadStatus"
      description: |-
        Describes whether a user has read the message or not
        NOTE  : This value is only available for ADVANCED messages
        NOTE 2: `UNAVAILABLE` will be returned if user revoked the permission to access to read status
    payment_status:
      $ref: "#/PaymentStatus"
      description: |-
        Describes the state of the related payment notice
        NOTE: This value is only available for ADVANCED payment messages
  required:
    - message

PublicMessage:
  x-one-of: true
  allOf:
    - $ref: "#/EnrichedMessage"
    - $ref: "#/CreatedMessageWithoutContent" 
MessageResponseNotificationStatus:
  type: object
  properties:
    email:
      $ref: "#/NotificationChannelStatusValue"
    webhook:
      $ref: "#/NotificationChannelStatusValue"

CreatedMessageWithContentAndEnrichedData:
  allOf:
    - $ref: "#/CreatedMessageWithContent"
    - $ref: "#/EnrichedMessage"

CreatedMessageWithContentResponse:
  x-one-of: true
  allOf:
    - $ref: "#/CreatedMessageWithContent"
    - $ref: "#/CreatedMessageWithContentAndEnrichedData"

InternalMessageResponseWithContent:
  type: object
  properties:
    message:
      $ref: "#/CreatedMessageWithContentResponse"
    status:
      $ref: "#/MessageStatusValue"
  required:
    - message

RCConfigurationPublic:
  allOf:
    - $ref: "#/RCConfigurationBase"
    - $ref: "#/RCConfigurationEnvironment"

NewRCConfigurationPublic:
  allOf:
    - $ref: "#/NewRCConfigurationBase"
    - $ref: "#/RCConfigurationEnvironment"

NewRCConfigurationBase:
  type: object
  properties:
    name:
      type: string
      minLength: 1
      description: Configuration name.
    description:
      type: string
      minLength: 1
      description: Configuration description.
    has_precondition:
       $ref: "#/HasPrecondition"
    disable_lollipop_for:
      type: array
      items:
        $ref: "#/FiscalCode"
    is_lollipop_enabled:
      type: boolean
      description: Flag to check if lollipop is enabled
  required:
    - name
    - description
    - has_precondition
    - disable_lollipop_for
    - is_lollipop_enabled
 
RCConfigurationBase:
  allOf:
      - $ref: "#/NewRCConfigurationBase"
      - type: object
        properties:
          configuration_id:
            type: string
            description: Ulid string.
            format: Ulid
            x-import: '@pagopa/ts-commons/lib/strings'
            example: 01ARZ3NDEKTSV4RRFFQ69G5FAV
        required:
          - configuration_id

RCConfigurationEnvironment:
  type: object
  properties:
    test_environment:
      $ref: "#/RCConfigurationTestEnvironment"
    prod_environment:
      $ref: "#/RCConfigurationProdEnvironment"

RCConfigurationProdEnvironment:
  type: object
  properties:
    base_url:
      type: string
      minLength: 1
      description: Base url of the server.
    details_authentication:
      $ref: "#/RCAuthenticationConfig"
  required:
    - base_url
    - details_authentication

RCAuthenticationConfig:
  type: object
  properties:
    header_key_name:
      type: string
      minLength: 1
      description: header key name
    key:
      type: string
      minLength: 1
      description: authentication config key
    type:
      type: string
      minLength: 1
      description: authentication config type
    cert:
      $ref: "#/RCClientCert"
  required:
    - header_key_name
    - key
    - type

RCClientCert:
  type: object
  properties:
    client_cert:
      type: string
      minLength: 1
      description: authentication config client cert
    client_key:
      type: string
      minLength: 1
      description: authentication config client key
    server_ca:
      type: string
      minLength: 1
      description: authentication config server ca
  required:
    - client_cert
    - client_key
    - server_ca

RCConfigurationTestEnvironment:
  allOf:
    - $ref: "#/RCConfigurationProdEnvironment"
    - type: object
      properties:
        test_users:
          type: array
          items:
            $ref: "#/FiscalCode"
      required:
      - test_users

MessageResponseWithContent:
  type: object
  properties:
    message:
      $ref: "#/CreatedMessageWithContent"
    notification:
      $ref: "#/MessageResponseNotificationStatus"
    status:
      $ref: "#/MessageStatusValue"
  required:
    - message
LegalMessageWithContent:
  allOf:
    - $ref: "#/CreatedMessageWithContent"
    - type: object
      properties:
        legal_message:
          $ref: "#/LegalMessage"
      required:
        - legal_message
LegalMessageResponseWithContent:
  allOf:
    - $ref: "#/MessageResponseWithContent"
    - type: object
      properties:
        message:
          $ref: "#/LegalMessageWithContent"
      required:
        - message
ThirdPartyMessageWithContent:
  allOf:
    - $ref: "#/CreatedMessageWithContent"
    - type: object
      properties:
        third_party_message:
          $ref: "#/ThirdPartyMessage"
      required:
        - third_party_message
ThirdPartyMessagePrecondition:
    type: object
    title: ThirdPartyMessagePrecondition
    description: Describes a message precondition
    properties:
      title:
        type: string
      markdown:
        type: string
    required:
      - title
      - markdown
MessageResponseWithoutContent:
  type: object
  properties:
    message:
      $ref: "#/CreatedMessageWithoutContent"
    notification:
      $ref: "#/MessageResponseNotificationStatus"
    status:
      $ref: "#/MessageStatusValue"
  required:
    - message
FiscalCode:
  type: string
  description: User's fiscal code.
  format: FiscalCode
  x-import: '@pagopa/ts-commons/lib/strings'
  example: SPNDNL80R13C555X
PrescriberFiscalCode:
  type: string
  description: Fiscal code of the Doctor that made the prescription.
  format: FiscalCode
  x-import: '@pagopa/ts-commons/lib/strings'
  example: TCNZRO80R13C555Y
SandboxFiscalCode:
  type: string
  description: |-
    Sandbox user's fiscal code (used for development).
  format: SandboxFiscalCode
  x-import: '@pagopa/ts-commons/lib/strings'
  example: SPNDNL80A13Y555X
OrganizationFiscalCode:
  type: string
  description: Organization fiscal code.
  format: OrganizationFiscalCode
  x-import: '@pagopa/ts-commons/lib/strings'
  example: "12345678901"
MessageSubject:
  type: string
  description: |-
    The subject of the message - note that only some notification
    channels support the display of a subject. When a subject is not provided,
    one gets generated from the client attributes.
  minLength: 10
  maxLength: 120
  example: Welcome new user !
MessageBodyMarkdown:
  type: string
  description: |-
    The full version of the message, in plain text or Markdown format. The
    content of this field will be delivered to channels that don't have any
    limit in terms of content size (e.g. email, etc...).
  minLength: 80
  maxLength: 10000
  example: |-
    # This is a markdown header

    to show how easily markdown can be converted to **HTML**

    Remember: this has to be a long text.
PaginationResponse:
  type: object
  description: Pagination response parameters.
  properties:
    prev:
      type: string
      description: Contains a value useful to get the previous page
      example: "first_id_of_the_page"
    next:
      type: string
      description: Contains a value useful to get the next page
      example: "last_id_of_the_page"  
CreatedMessageWithoutContentCollection:
  description: A collection of messages
  type: object
  properties:
    items:
      type: array
      items:
        $ref: "#/CreatedMessageWithoutContent"
  required:
    - items
PaginatedCreatedMessageWithoutContentCollection:
  description: A paginated collection of messages
  allOf:
    - $ref: "#/CreatedMessageWithoutContentCollection"
    - $ref: "#/PaginationResponse"
PublicMessagesCollection:
  description: A collection of messages
  type: object
  properties:
    items:
      type: array
      items:
        $ref: "#/PublicMessage"
  required:
    - items
PaginatedPublicMessagesCollection:
  description: A paginated collection of messages
  allOf:
    - $ref: "#/PublicMessagesCollection"
    - $ref: "#/PaginationResponse"
BlockedInboxOrChannels:
  type: object
  additionalProperties:
    type: array
    items:
      $ref: "#/BlockedInboxOrChannel"
  description: |-
    All the notification channels blocked by the user.
    Each channel is related to a specific service (sender).
NewProfile:
  type: object
  description: |-
    Describes a new citizen's profile.
    Used for profile creation.
  properties:
    email:
      $ref: "#/EmailAddress"
    is_email_validated:
      $ref: "#/IsEmailValidated"
    is_test_profile:
      $ref: "#/IsTestProfile"
  required:
    - is_email_validated
Profile:
  type: object
  description: |-
    Describes the citizen's profile.
    Used for profile update.
  properties:
    email:
      $ref: "#/EmailAddress"
    service_preferences_settings:
      $ref: "#/ServicePreferencesSettings"
    blocked_inbox_or_channels:
      $ref: "#/BlockedInboxOrChannels"
    preferred_languages:
      $ref: "#/PreferredLanguages"
    is_inbox_enabled:
      $ref: "#/IsInboxEnabled"
    accepted_tos_version:
      $ref: "#/AcceptedTosVersion"
    is_webhook_enabled:
      $ref: "#/IsWebhookEnabled"
    is_email_enabled:
      $ref: "#/IsEmailEnabled"
    reminder_status:
      $ref: "#/ReminderStatus"
    last_app_version:
      $ref: "#/AppVersion"
    push_notifications_content_type:
      $ref: "#/PushNotificationsContentType"
    version:
      type: integer
  required:
    - version
LimitedProfile:
  description: |-
    Describes the citizen's profile, mostly interesting for preferences
    attributes.
  type: object
  properties:
    sender_allowed:
      type: boolean
      description: |-
        True in case the service that made the request can send
        messages to the user identified by this profile (false otherwise).
    preferred_languages:
      $ref: "#/PreferredLanguages"
  required:
    - sender_allowed
ExtendedProfile:
  description: |-
    Describes the citizen's profile, mostly interesting for preferences
    attributes.
  type: object
  properties:
    email:
      $ref: "#/EmailAddress"
    service_preferences_settings:
      $ref: "#/ServicePreferencesSettings"
    blocked_inbox_or_channels:
      $ref: "#/BlockedInboxOrChannels"
    preferred_languages:
      $ref: "#/PreferredLanguages"
    is_inbox_enabled:
      $ref: "#/IsInboxEnabled"
    accepted_tos_version:
      $ref: "#/AcceptedTosVersion"
    is_webhook_enabled:
      $ref: "#/IsWebhookEnabled"
    is_email_enabled:
      $ref: "#/IsEmailEnabled"
    is_email_validated:
      $ref: "#/IsEmailValidated"
    is_email_already_taken:
      $ref: "#/IsEmailAlreadyTaken"
    reminder_status:
      $ref: "#/ReminderStatus"
    is_test_profile:
      $ref: "#/IsTestProfile"
    last_app_version:
      $ref: "#/AppVersion"
    push_notifications_content_type:
      $ref: "#/PushNotificationsContentType"
    version:
      type: integer
  required:
    - is_email_enabled
    - is_email_validated
    - is_email_already_taken
    - is_inbox_enabled
    - is_webhook_enabled
    - service_preferences_settings
    - version
IsEmailValidated:
  type: boolean
  description: |-
    True if the user email has been validated.
IsEmailAlreadyTaken:
  type: boolean
  default: false
  description: |-
    True if the user email has been validated by another user.
    If so, the user must provide a new email.
IsInboxEnabled:
  type: boolean
  description: |-
    True if the recipient of a message wants to store its content for
    later retrieval.
AcceptedTosVersion:
  type: number
  minimum: 1
  description: |-
    Version of latest terms of service accepted by the user.
IsWebhookEnabled:
  type: boolean
  description: True if the recipient of a message wants to forward the notifications to the default webhook.
IsEmailEnabled:
  type: boolean
  description: True if the recipient of a message wants to forward the notifications to his email address.
ReminderStatus:
  type: string
  x-extensible-enum:
    - ENABLED
    - DISABLED
  example: ENABLED
  description:
    Api definition of reminder opt-in status
IsTestProfile:
  type: boolean
  description: True if the user's profile is only for test purpose. 
  default: false
AppVersion:
  type: string
  pattern: '^((0|[1-9]\\d*)\\.){2}(0|[1-9]\\d*)(\\.(0|[1-9]\\d*)){0,1}$'
  description: A string field in Semantic Versioning format
  example: "1.10.11"
PushNotificationsContentType:
  type: string
  x-extensible-enum:
    - FULL
    - ANONYMOUS
  example: FULL
  description: |-
    This parameter specifies how a specific user wants to visualize push notifications.
    FULL leads to descriptive push notifications while ANONYMOUS leads to silent ones.
TimeToLiveSeconds:
  type: integer
  default: 3600
  minimum: 3600
  maximum: 604800
  description: |-
    This parameter specifies for how long (in seconds) the system will
    try to deliver the message to the channels configured by the user.
  example: 3600
HttpStatusCode:
  type: integer
  format: int32
  description: The HTTP status code generated by the origin server for this occurrence of the problem.
  minimum: 100
  maximum: 600
  exclusiveMaximum: true
  example: 200
NewMessageDefaultAddresses:
  type: object
  description: |-
    Default addresses for notifying the recipient of the message in case
    no address for the related channel is set in his profile.
  properties:
    email:
      $ref: "#/EmailAddress"
EmailAddress:
  type: string
  format: email
  example: foobar@example.com
PreferredLanguage:
  type: string
  x-extensible-enum:
    - it_IT
    - en_GB
    - es_ES
    - de_DE
    - fr_FR
  example: it_IT
PreferredLanguages:
  type: array
  items:
    $ref: "#/PreferredLanguage"
  description: |-
    Indicates the User's preferred written or spoken languages in order
    of preference. Generally used for selecting a localized User interface. Valid
    values are concatenation of the ISO 639-1 two letter language code, an underscore,
    and the ISO 3166-1 2 letter country code; e.g., 'en_US' specifies the language
    English and country US.
SenderMetadata:
  title: Sender metadata
  description: Metadata associated to a sender (service).
  type: object
  properties:
    service_name:
      $ref: "#/ServiceName"
    organization_name:
      $ref: "#/OrganizationName"
    department_name:
      $ref: "#/DepartmentName"
  required:
    - service_name
    - organization_name
    - department_name
ServicePayload:
  description: A payload used to create/update a service for a user.
  x-one-of: true
  allOf:
   - $ref: "#/VisibleServicePayload"
   - $ref: "#/HiddenServicePayload"
ExtendedServicePayload:
  allOf:
    - $ref: "#/ServicePayload"
    - type: object
      properties:
        service_metadata:
          $ref: "#/ServiceMetadata"
CommonServicePayload:
  description: Common properties for a ServicePayload
  type: object
  properties:
    service_name:
      $ref: "#/ServiceName"
    department_name:
      $ref: "#/DepartmentName"
    organization_name:
      $ref: "#/OrganizationName"
    organization_fiscal_code:
      $ref: "#/OrganizationFiscalCode"
    authorized_cidrs:
      description: |-
        Allowed source IPs or CIDRs for this service.
        When empty, every IP address it's authorized to call the IO API on behalf of the service.
      type: array
      items:
        $ref: "#/CIDR"
    version:
      type: integer
    require_secure_channels:
      type: boolean
      default: false
      description: |
        When true:
        * Messages won't trigger email notifications;
        * Push notifications will be anonymous.
  required:
    - service_name
    - department_name
    - organization_name
    - organization_fiscal_code
    - authorized_cidrs
VisibleServicePayload:
  description: A payload used to create/update a service that appears in the service list.
  allOf:
  - $ref: "#/CommonServicePayload"
  - type: object
    properties:
      is_visible:
        type: boolean
        enum:
          - true
        description: |-
          It indicates that service appears in the service list
      service_metadata:
        description: |-
          That service can't handle some ServiceMetadata fields (es. category)
        $ref: "#/CommonServiceMetadata"
    required:
      - is_visible
      - service_metadata
HiddenServicePayload:
  description: A payload used to create/update a service that is hidden.
  allOf:
  - $ref: "#/CommonServicePayload"
  - type: object
    properties:
      is_visible:
        type: boolean
        default: false
        enum:
          - false
        description: |-
          It indicates that service is hidden
      service_metadata:
        description: |-
          That service can't handle some ServiceMetadata fields (es. category)
        $ref: "#/CommonServiceMetadata"
Service: 
  description: A service tied to user's subscription.
  allOf:
  - $ref: "#/ExtendedServicePayload"
  - type: object
    properties:
      id:
        type: string
      service_id:
        $ref: "#/ServiceId"
      authorized_recipients:
        description: |-
          If non empty, the service will be able
          to send messages only to these fiscal codes.
        type: array
        items:
          $ref: "#/FiscalCode"
      max_allowed_payment_amount:
        $ref: "#/MaxAllowedPaymentAmount"
    required:
      - service_id
      - authorized_recipients
CommonServiceMetadata:
  type: object
  description: A set of metadata properties related to this service.
  properties:
    description:
      type: string
      minLength: 1
    web_url:
      type: string
      minLength: 1
    app_ios:
      type: string
      minLength: 1
    app_android:
      type: string
      minLength: 1
    tos_url:
      type: string
      minLength: 1
    privacy_url:
      type: string
      minLength: 1
    address:
      type: string
      minLength: 1
    phone:
      type: string
      minLength: 1
    email:
      type: string
      minLength: 1
    pec:
      type: string
      minLength: 1
    cta:
      type: string
      minLength: 1
    token_name: 
      type: string
      minLength: 1
    support_url:
      type: string
      minLength: 1
    scope:
      $ref: "#/ServiceScope"
  required:
    - scope
StandardServiceMetadata:
  allOf:
    - $ref: "#/CommonServiceMetadata"
    - type: object
      properties:
        category:
          $ref: "#/StandardServiceCategory"
      required:
        - category
SpecialServiceMetadata:
  allOf:
    - $ref: "#/CommonServiceMetadata"
    - type: object
      properties:
        category:
          $ref: "#/SpecialServiceCategory"
        custom_special_flow:
          type: string
          minLength: 1
      required:
        - category
ServiceMetadata:
  x-one-of: true
  allOf:
    - $ref: "#/StandardServiceMetadata"
    - $ref: "#/SpecialServiceMetadata"
    - $ref: "#/CommonServiceMetadata"
SpecialServiceCategory:
  type: string
  x-extensible-enum:
    - SPECIAL
StandardServiceCategory:
  type: string
  x-extensible-enum:
    - STANDARD
ServiceCategory:
  x-one-of: true
  allOf:
    - $ref: "#/SpecialServiceCategory"
    - $ref: "#/StandardServiceCategory"
ServiceScope:
  type: string
  x-extensible-enum:
    - NATIONAL
    - LOCAL
ServiceTupleCollection:
  description: A collection of services tuples (service and version)
  type: object
  properties:
    items:
      type: array
      items:
        $ref: "#/ServiceTuple"
  required:
    - items
PaginatedServiceTupleCollection:
  description: A paginated collection of services tuples
  allOf:
    - $ref: "#/ServiceTupleCollection"
    - $ref: "#/PaginationResponse"
ServicePublic:
  title: Service (public)
  description: A Service associated to an user's subscription.
  type: object
  properties:
    service_id:
      $ref: "#/ServiceId"
    service_name:
      $ref: "#/ServiceName"
    organization_name:
      $ref: "#/OrganizationName"
    department_name:
      $ref: "#/DepartmentName"
    organization_fiscal_code:
      $ref: "#/OrganizationFiscalCode"
    available_notification_channels:
      $ref: "#/AvailableNotificationChannels"
    version:
      type: integer
    service_metadata:
      $ref: "#/ServiceMetadata"
  required:
    - service_id
    - service_name
    - organization_name
    - department_name
    - organization_fiscal_code
    - version
ServiceId:
  type: string
  description: |-
    The ID of the Service. Equals the subscriptionId of a registered
    API user.
  minLength: 1
ServiceTuple:
  description: Service identifier and version used to return list of services.
  type: object
  properties:
    service_id:
      $ref: "#/ServiceId"
    scope:
      $ref: "#/ServiceScope"
    version:
      type: integer
  required:
    - service_id
    - version
UserDataProcessing:
  type: object
  description: |-
    A representation of a single user data processing request
  properties:
    choice:
      $ref: "#/UserDataProcessingChoice"
    status:
      $ref: "#/UserDataProcessingStatus"
    created_at:
      $ref: "#/Timestamp"
    updated_at:
      $ref: "#/Timestamp"
    version:
      type: integer
  required:
    - choice
    - status
    - version
ServiceName:
  type: string
  description: The name of the service. Will be added to the content of sent messages.
  minLength: 1
OrganizationName:
  type: string
  description: |-
    The organization that runs the service. Will be added to the content
    of sent messages to identify the sender.
  minLength: 1
DepartmentName:
  type: string
  description: |-
    The department inside the organization that runs the service. Will
    be added to the content of sent messages.
  minLength: 1
AvailableNotificationChannels:
  description: |-
    All the notification channels available for a service.
  type: array
  items:
    $ref: "#/NotificationChannel"
CIDR:
  type: string
  description: Describes a single IP or a range of IPs.
  pattern: "^([0-9]{1,3}[.]){3}[0-9]{1,3}(/([0-9]|[1-2][0-9]|3[0-2]))?$"
Timestamp:
  type: string
  format: UTCISODateFromString
  description: A date-time field in ISO-8601 format and UTC timezone.
  x-import: '@pagopa/ts-commons/lib/dates'
  example: "2018-10-13T00:00:00.000Z"
HttpsUrl:
  type: string
  format: uri
  description: An http(s) url.
  pattern: "^https://[-a-zA-Z0-9@:%._+~#=]{2,256}[.][a-z]{2,6}\\\\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$"
UserDataProcessingStatus:
  type: string
  description: |-
    The status of a user data processing request
  enum:
    - PENDING
    - WIP
    - CLOSED
    - FAILED
    - ABORTED
  example: PENDING
UserDataProcessingChoice:
  type: string
  description: |-
    User's choice to delete or download his own data.
  enum:
    - DOWNLOAD
    - DELETE
  example: DOWNLOAD
UserDataProcessingChoiceRequest:
  type: object
  description: |-
    A request wrapper for User data processing choice
  properties:
    choice:
      $ref: "#/UserDataProcessingChoice"
  required:
    - choice
ServicePreferencesSettings:
  description: |-
    Describes the citizen's profile, mostly interesting for preferences
    attributes.
  type: object
  properties:
    mode:
      $ref: "#/ServicesPreferencesMode"
  required:
    - mode
ServicesPreferencesMode:
  type: string
  enum:
    - LEGACY
    - AUTO
    - MANUAL
BasicServicePreference:
  description: |-
    Define a set of required preferences of a Citizen for a given Service.
    It's needed by Citizens to express how they want Services to get in touch with them.
  type: object
  properties:
    is_email_enabled:
      type: boolean
    is_inbox_enabled:
      type: boolean
    is_webhook_enabled:
      type: boolean
    settings_version:
      type: integer
      minimum: 0
  required:
    - is_email_enabled
    - is_inbox_enabled
    - is_webhook_enabled
    - settings_version
ServicePreference:
  description: |-
    Return the set of preferences of a Citizen for a given Service.
    It's needed by Citizens to read previoulsy expressed preferences.
  allOf:
    - $ref: "#/BasicServicePreference"
    - type: object
      properties:
        can_access_message_read_status:
          type: boolean
      required:
        - can_access_message_read_status
UpsertServicePreference:
  description: |-
    Define a set of preferences of a Citizen for a given Service.
    Extends the BasicServicePreference with new optional preferences for backward compatibility.
  allOf:
    - $ref: "#/BasicServicePreference"
    - type: object
      properties:
        can_access_message_read_status:
          type: boolean
ActivationStatus:
  type: string
  x-extensible-enum:
    - ACTIVE
    - INACTIVE
    - PENDING
Activation:
  type: object
  properties:
    service_id:
      $ref: "#/ServiceId"
    fiscal_code:
      $ref: "#/FiscalCode"
    status:
      $ref: "#/ActivationStatus"
    version:
      type: integer
      minimum: 0
  required:
    - service_id
    - fiscal_code
    - status
    - version
ActivationPayload:
  type: object
  properties:
    fiscal_code:
      $ref: "#/FiscalCode"
    status:
      $ref: "#/ActivationStatus"
  required:
    - fiscal_code
    - status
MessageCategory:
  x-one-of: true
  allOf:
    - $ref: "#/MessageCategoryPayment"
    - $ref: "#/MessageCategoryBase"
    - $ref: "#/MessageCategoryPN"
MessageCategoryBase:
  type: object
  properties:
    tag:
      type: string
      enum:
        - LEGAL_MESSAGE
        - EU_COVID_CERT
        - GENERIC
  required:
    - tag
MessageCategoryPayment:
  type: object
  properties: 
    tag:
      type: string
      enum:
        - PAYMENT
    rptId:
      type: string
  required:
    - tag
    - rptId
MessageCategoryPN:
  allOf:
    - $ref: "#/ThirdPartyData"
    - type: object
      properties: 
        tag:
          type: string
          enum:
            - PN
      required:
        - tag
LegalMessage:
  type: object
  properties:
    eml: 
      $ref: "#/LegalMessageEml"
    cert_data:
      $ref: "#/LegalMessageCertData"
  required: 
    - eml
    - cert_data
LegalMessageEml:
  type: object
  properties:
    subject:
      type: string
    plain_text_content:
      type: string
    html_content:
      type: string
    attachments:
      type: array
      items:
        $ref: '#/Attachment'
  required:
    - subject
    - plain_text_content
    - html_content
    - attachments
LegalMessageCertData:
  type: object
  properties:
    header:
      $ref: "#/CertDataHeader"
    data:
      $ref: "#/CertData"
  required:
    - header
    - data
CertData:
  type: object
  properties:
    sender_provider:
      type: string
      minLength: 1
    timestamp:
      type: string
      format: date-time
    envelope_id:
      type: string
      minLength: 1
    msg_id:
      type: string
      minLength: 1
    receipt_type:
      type: string
  required:
    - sender_provider
    - timestamp
    - envelope_id
    - msg_id
    - receipt_type
CertDataHeader:
  type: object
  properties:
    sender:
      type: string
      minLength: 1
    recipients:
      type: string
      minLength: 1
    replies:
      type: string
      minLength: 1
    object:
      type: string
      minLength: 1
  required:
    - sender
    - recipients
Attachment:
  type: object
  properties:
    id:
      type: string
    content_type:
      type: string
    name:
      type: string
    url:
      type: string
  required:
    - id
    - content_type
    - name
ImpersonatedService:
  type: object
  properties:
    service_id:
      type: string
    user_groups:
      type: string
    user_email:
      type: string
  required:
    - service_id
    - user_groups
    - user_email
ThirdPartyMessage:
  type: object
  properties:
    attachments: 
      type: array
      items: 
        $ref: "#/ThirdPartyAttachment"
    # We expects additional properties to be free-form objects
    details:
      type: object
      additionalProperties: true
ThirdPartyAttachment:
  type: object
  properties:
      id:
        type: string
        minLength: 1
      content_type:
        type: string
        minLength: 1
      name:
        type: string
        minLength: 1
      url:
        type: string
        minLength: 1
      category:
        type: string
        default: DOCUMENT
  required:
    - id
    - url
MessageStatusReadingChange:
  type: object
  properties:
    change_type:
      type: string
      enum: 
        - reading
    is_read:
      type: boolean
      enum:
        - true
  required:
    - change_type
    - is_read
MessageStatusArchivingChange:
  type: object
  properties:
    change_type:
      type: string
      enum: 
        - archiving
    is_archived:
      type: boolean
  required:
    - change_type
    - is_archived
MessageStatusBulkChange:
  type: object
  properties:
    change_type:
      type: string
      enum: 
        - bulk
    is_archived:
      type: boolean
    is_read:
      type: boolean
      enum:
        - true
  required:
    - change_type
    - is_archived
MessageStatusChange:
  x-one-of: true
  allOf:
    - $ref: "#/MessageStatusReadingChange"
    - $ref: "#/MessageStatusArchivingChange"
    - $ref: "#/MessageStatusBulkChange"
MessageStatusAttributes:
  type: object
  properties:
    is_read:
      type: boolean
      default: false
    is_archived:
      type: boolean
      default: false
  required:
    - is_read
    - is_archived
PaymentStatus:
  type: string
  description: |-
    Payment status enumeration
  x-extensible-enum:
    - PAID
    - NOT_PAID
  example: NOT_PAID
ReadStatus:
  type: string
  x-extensible-enum:
    - UNAVAILABLE
    - UNREAD
    - READ
  example: UNREAD
  description:
    Api definition of read status enumeration
Ulid:
  type: string
  description: Ulid string.
  format: Ulid
  x-import: '@pagopa/ts-commons/lib/strings'
  example: 01ARZ3NDEKTSV4RRFFQ69G5FAV
PathTraversalSafePathParam:
  description:
    A non empty string that is safe to be used in an url parameter to avoid path traversal attacks
  type: string
  pattern: "^[0-9a-zA-Z\\-\\._\\/+]+$"
UnlockCode:
  type: string
  pattern: ^\\d{9}$
