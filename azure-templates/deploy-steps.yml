# Azure DevOps template used to publish the package in the NPM registry and
# create a new corresponding release in the GitHub repository. 

parameters:
  - name: 'deployType'
    type: string
    default: publishPackage
    values:
      - publishPackage
  
  - name: 'packageVersion'
    type: string
    default: ''

  - name: 'githubToken'
    type: string
    default: ''

  - name: 'npmToken'
    type: string
    default: ''
    
steps:
  - template: ./make-build-steps.yml
    parameters:
      make: build
    
  - bash: |
      echo registry=https://registry.npmjs.com/ >> .npmrc
      echo \//registry.npmjs.org/:_authToken=$NPM_TOKEN >> .npmrc
    env:
      NPM_TOKEN: '${{ parameters.npmToken }}'
    displayName: 'Init .npmrc file'
  
  - script: |
      yarn release-it $PACKAGE_VERSION
    env:
      GITHUB_TOKEN: '${{ parameters.githubToken }}'
      PACKAGE_VERSION: '${{ parameters.packageVersion }}'
    displayName: 'release-it'
  